<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÑ‚Äç‚ôÇÔ∏è SurfAI - App Intelligente (Backend)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .nav-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .nav-tab.active {
            background: #667eea;
            color: white;
        }
        
        .nav-tab:hover:not(.active) {
            background: #f0f0f0;
        }
        
        .tab-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .button.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .button.secondary:hover {
            background: #cbd5e0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .forecast-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .forecast-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .forecast-card.excellent {
            border-color: #48bb78;
            background: linear-gradient(45deg, #f0fff4, #ffffff);
        }
        
        .forecast-card.good {
            border-color: #4299e1;
            background: linear-gradient(45deg, #ebf8ff, #ffffff);
        }
        
        .forecast-card.average {
            border-color: #ed8936;
            background: linear-gradient(45deg, #fffaf0, #ffffff);
        }
        
        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .forecast-date {
            font-weight: bold;
            color: #667eea;
        }
        
        .forecast-score {
            background: #48bb78;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .forecast-score.excellent {
            background: #48bb78;
        }
        
        .forecast-score.good {
            background: #4299e1;
        }
        
        .forecast-score.average {
            background: #ed8936;
        }
        
        .forecast-score.poor {
            background: #f56565;
        }
        
        .forecast-conditions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .condition {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .prediction-info {
            background: #f7fafc;
            border-radius: 6px;
            padding: 8px;
            margin-top: 8px;
            font-size: 0.85rem;
        }
        
        .prediction-recommendation {
            font-weight: 600;
            color: #4a5568;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #c6f6d5;
            color: #25543e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .backend-status {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
        }
        
        .backend-status.connected {
            background: #f0fff4;
            border-color: #68d391;
        }
        
        .backend-status.error {
            background: #fed7d7;
            border-color: #fc8181;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                min-width: auto;
                flex: 1;
            }
            
            .forecast-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèÑ‚Äç‚ôÇÔ∏è SurfAI</h1>
            <p>Version Backend S√©curis√©e - Intelligence de surf avanc√©e</p>
        </div>
        
        <!-- Backend Status -->
        <div id="backend-status" class="backend-status">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="backend-indicator">üîµ</span>
                <span id="backend-message">V√©rification connexion backend...</span>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('sessions')">üèÑ‚Äç‚ôÇÔ∏è Sessions</button>
            <button class="nav-tab" onclick="showTab('spots')">üìç Spots</button>
            <button class="nav-tab" onclick="showTab('profile')">üë§ Profile</button>
            <button class="nav-tab" onclick="showTab('predictions')">üéØ Pr√©dictions</button>
            <button class="nav-tab" onclick="showTab('meteo')">üåä M√©t√©o</button>
            <button class="nav-tab" onclick="showTab('config')">‚öôÔ∏è Configuration</button>
        </div>
        
        <!-- Content -->
        <div class="tab-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-panel active">
                <h2>üìä Tableau de bord</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-sessions">-</div>
                        <div class="stat-label">Sessions totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avg-rating">-</div>
                        <div class="stat-label">Note moyenne</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="favorite-spots">-</div>
                        <div class="stat-label">Spots favoris</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="backend-status-indicator">üî¥</div>
                        <div class="stat-label">Backend SurfAI</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üéØ Prochaines sessions recommand√©es (IA)</h3>
                    <div id="recommendations">
                        <div class="loading">Chargement des recommandations intelligentes...</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìà Vos patterns de surf</h3>
                    <div id="patterns">
                        <p>Analysez vos sessions pour d√©couvrir vos conditions pr√©f√©r√©es !</p>
                        <button class="button" onclick="analyzePatterns()">Analyser mes patterns</button>
                    </div>
                </div>
            </div>
            
            <!-- Sessions Tab -->
            <div id="sessions" class="tab-panel">
                <h2>üèÑ‚Äç‚ôÇÔ∏è Mes Sessions</h2>
                
                <div class="card">
                    <h3>‚ûï Ajouter une nouvelle session</h3>
                    <div id="session-form">
                        <div class="form-group">
                            <label>Date de la session</label>
                            <input type="date" id="session-date" required>
                        </div>
                        <div class="form-group">
                            <label>Spot</label>
                            <select id="session-spot" required>
                                <option value="">S√©lectionnez un spot</option>
                                <option value="Biarritz Grande Plage">Biarritz Grande Plage</option>
                                <option value="Hossegor">Hossegor</option>
                                <option value="Anglet">Anglet</option>
                                <option value="Hendaye">Hendaye</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Note de la session (1-10)</label>
                            <select id="session-rating" required>
                                <option value="">Choisir une note</option>
                                <option value="1">1 ‚≠ê - D√©cevant</option>
                                <option value="2">2 ‚≠ê - Faible</option>
                                <option value="3">3 ‚≠ê - Correct</option>
                                <option value="4">4 ‚≠ê - Bon</option>
                                <option value="5">5 ‚≠ê - Tr√®s bon</option>
                                <option value="6">6 ‚≠ê - Excellent</option>
                                <option value="7">7 ‚≠ê - Super</option>
                                <option value="8">8 ‚≠ê - G√©nial</option>
                                <option value="9">9 ‚≠ê - Parfait</option>
                                <option value="10">10 ‚≠ê - L√©gendaire</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Commentaires</label>
                            <textarea id="session-notes" rows="3" placeholder="D√©crivez votre session..."></textarea>
                        </div>
                        <button onclick="submitSession()" class="button">üíæ Enregistrer la session</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìã Historique des sessions</h3>
                    <div id="sessions-list">
                        <div class="loading">Chargement des sessions...</div>
                    </div>
                </div>
            </div>
            
            <!-- Spots Tab -->
            <div id="spots" class="tab-panel">
                <h2>üìç Mes Spots</h2>
                
                <div class="card">
                    <h3>‚≠ê Spots favoris</h3>
                    <div id="favorite-spots-list">
                        <div class="loading">Chargement des spots favoris...</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üåä Tous les spots disponibles</h3>
                    <div id="all-spots-list">
                        <div class="loading">Chargement des spots...</div>
                    </div>
                </div>
            </div>
            
            <!-- Profile Tab -->
            <div id="profile" class="tab-panel">
                <h2>üë§ Mon Profile</h2>
                
                <!-- Informations personnelles -->
                <div class="card">
                    <h3>üèÑ‚Äç‚ôÇÔ∏è Informations de surfeur</h3>
                    <div id="profile-form">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div class="form-group">
                                <label>Pseudo</label>
                                <input type="text" id="profile-nickname" placeholder="Votre pseudo">
                            </div>
                            <div class="form-group">
                                <label>Niveau de surf</label>
                                <select id="profile-level">
                                    <option value="beginner">üå± D√©butant</option>
                                    <option value="intermediate" selected>üèÑ‚Äç‚ôÇÔ∏è Interm√©diaire</option>
                                    <option value="advanced">üåä Avanc√©</option>
                                    <option value="expert">üèÜ Expert</option>
                                </select>
                            </div>
                        </div>
                        
                        <h4 style="margin: 20px 0 10px 0;">üåä Pr√©f√©rences de vagues</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="form-group">
                                <label>Taille min (m√®tres)</label>
                                <input type="number" id="profile-wave-min" step="0.1" min="0.3" max="5" placeholder="0.8">
                            </div>
                            <div class="form-group">
                                <label>Taille max (m√®tres)</label>
                                <input type="number" id="profile-wave-max" step="0.1" min="0.5" max="8" placeholder="2.5">
                            </div>
                        </div>
                        
                        <button onclick="saveProfile()" class="button">üíæ Sauvegarder le profil</button>
                    </div>
                </div>
                
                <!-- Mes Boards -->
                <div class="card">
                    <h3>üèÑ‚Äç‚ôÇÔ∏è Mes Boards</h3>
                    
                    <!-- Formulaire ajout board -->
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4>‚ûï Ajouter une board</h4>
                        <div id="board-form">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div class="form-group">
                                    <label>Nom de la board</label>
                                    <input type="text" id="board-name" placeholder="Ex: Ma Longboard" required>
                                </div>
                                <div class="form-group">
                                    <label>Taille (pieds)</label>
                                    <input type="text" id="board-size" placeholder="Ex: 9'2" required>
                                </div>
                                <div class="form-group">
                                    <label>Type</label>
                                    <select id="board-type" required>
                                        <option value="">Choisir un type</option>
                                        <option value="longboard">üèÑ‚Äç‚ôÇÔ∏è Longboard</option>
                                        <option value="midlength">üèÑ‚Äç‚ôÄÔ∏è Midlength</option>
                                        <option value="shortboard">‚ö° Shortboard</option>
                                        <option value="fish">üê† Fish</option>
                                        <option value="gun">üöÄ Gun</option>
                                        <option value="funboard">üòä Funboard</option>
                                        <option value="sup">üèÑ‚Äç‚ôÇÔ∏è SUP</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Shaper</label>
                                    <input type="text" id="board-shaper" placeholder="Ex: Robert August" required>
                                </div>
                            </div>
                            <button onclick="addBoard()" class="button">‚ûï Ajouter cette board</button>
                        </div>
                    </div>
                    
                    <!-- Liste des boards -->
                    <div id="user-boards-list">
                        <div class="loading">Chargement de vos boards...</div>
                    </div>
                </div>
            </div>
            
            <!-- Predictions Tab -->
            <div id="predictions" class="tab-panel">
                <h2>üéØ Pr√©dictions Intelligentes</h2>
                
                <div class="card">
                    <h3>üèÜ Recommandations pour les prochains jours</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Votre niveau</label>
                            <select id="prediction-level">
                                <option value="beginner">üå± D√©butant</option>
                                <option value="intermediate" selected>üèÑ‚Äç‚ôÇÔ∏è Interm√©diaire</option>
                                <option value="advanced">üåä Avanc√©</option>
                                <option value="expert">üèÜ Expert</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nombre de jours</label>
                            <select id="prediction-days">
                                <option value="1">1 jour</option>
                                <option value="2" selected>2 jours</option>
                                <option value="3">3 jours</option>
                                <option value="5">5 jours</option>
                            </select>
                        </div>
                    </div>
                    <button class="button" onclick="generateIntelligentPredictions()">üîÆ G√©n√©rer pr√©dictions IA</button>
                    <div id="predictions-list">
                        <p>Cliquez sur "G√©n√©rer pr√©dictions IA" pour voir les meilleures sessions √† venir !</p>
                    </div>
                </div>
            </div>
            
            <!-- Meteo Tab -->
            <div id="meteo" class="tab-panel">
                <h2>üåä M√©t√©o Marine</h2>
                
                <div class="card">
                    <h3>üß™ Test Backend SurfAI</h3>
                    <p>Testez votre connexion au backend s√©curis√©</p>
                    <button class="button" onclick="testBackendConnection()">üîç Tester le Backend</button>
                    <div id="backend-test-result"></div>
                </div>
                
                <div class="card">
                    <h3>üì° Pr√©visions en temps r√©el</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Choisir un spot</label>
                            <select id="forecast-spot">
                                <option value="">S√©lectionnez un spot</option>
                                <option value="biarritz">üèÑ‚Äç‚ôÇÔ∏è Biarritz</option>
                                <option value="hossegor">üåä Hossegor</option>
                                <option value="mimizan">üèñÔ∏è Mimizan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Votre niveau</label>
                            <select id="forecast-level">
                                <option value="beginner">üå± D√©butant</option>
                                <option value="intermediate" selected>üèÑ‚Äç‚ôÇÔ∏è Interm√©diaire</option>
                                <option value="advanced">üåä Avanc√©</option>
                                <option value="expert">üèÜ Expert</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nombre de jours</label>
                            <select id="forecast-days">
                                <option value="1">1 jour</option>
                                <option value="2" selected>2 jours</option>
                                <option value="3">3 jours</option>
                            </select>
                        </div>
                    </div>
                    <button class="button" onclick="getIntelligentForecast()">üåä R√©cup√©rer pr√©visions IA</button>
                    <div id="forecast-result">
                        <div class="forecast-grid" id="forecast-grid"></div>
                    </div>
                </div>
            </div>
            
            <!-- Config Tab -->
            <div id="config" class="tab-panel">
                <h2>‚öôÔ∏è Configuration</h2>
                
                <div class="card">
                    <h3>üöÄ Configuration Backend SurfAI</h3>
                    <div class="form-group">
                        <label>URL Backend</label>
                        <input type="text" id="backend-url" value="https://surfai-backend-production.up.railway.app" placeholder="https://surfai-backend-production.up.railway.app">
                    </div>
                    <div class="form-group">
                        <label>Cl√© API (optionnelle)</label>
                        <input type="password" id="backend-api-key" placeholder="Cl√© API pour routes prot√©g√©es">
                    </div>
                    <button class="button" onclick="testBackendConnection()">üîç Tester connexion</button>
                </div>
                
                <div class="card">
                    <h3>üìä √âtat de l'application</h3>
                    <div id="app-status">
                        <p>üî¥ Backend: Non test√©</p>
                        <p>üî¥ IA Engine: Non v√©rifi√©</p>
                        <p>üî¥ Donn√©es: Non charg√©es</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let backendUrl = 'https://surfai-backend-production.up.railway.app';
        let backendApiKey = null;
        let userData = {
            sessions: [],
            spots: [],
            favoriteSpots: [],
            predictions: [],
            profile: {},
            boards: []
        };

        // Configuration initiale
        document.addEventListener('DOMContentLoaded', async function() {
            // D√©finir la date d'aujourd'hui par d√©faut
            document.getElementById('session-date').value = new Date().toISOString().split('T')[0];
            
            // Charger config sauvegard√©e
            const savedBackendUrl = localStorage.getItem('backend_url');
            const savedApiKey = localStorage.getItem('backend_api_key');
            
            if (savedBackendUrl) {
                backendUrl = savedBackendUrl;
                document.getElementById('backend-url').value = savedBackendUrl;
            }
            if (savedApiKey) {
                backendApiKey = savedApiKey;
                document.getElementById('backend-api-key').value = savedApiKey;
            }
            
            // Test auto du backend
            await checkBackendConnection();
            
            // Charger donn√©es de base
            loadSessions();
            loadSpots();
            loadProfile();
            
            // Charger recommandations intelligentes par d√©faut
            await generateIntelligentRecommendations();
        });

        // ========================================
        // FONCTIONS BACKEND CORRIG√âES
        // ========================================

        // V√©rifier connexion backend
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${backendUrl}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    updateBackendStatus(true, 'Backend connect√© et op√©rationnel');
                    document.getElementById('backend-status-indicator').textContent = 'üü¢';
                    return true;
                } else {
                    throw new Error('Backend non disponible');
                }
            } catch (error) {
                updateBackendStatus(false, `Backend non accessible: ${error.message}`);
                document.getElementById('backend-status-indicator').textContent = 'üî¥';
                return false;
            }
        }

        // Mettre √† jour le statut backend
        function updateBackendStatus(connected, message) {
            const statusDiv = document.getElementById('backend-status');
            const indicator = document.getElementById('backend-indicator');
            const messageEl = document.getElementById('backend-message');
            
            if (connected) {
                statusDiv.className = 'backend-status connected';
                indicator.textContent = 'üü¢';
            } else {
                statusDiv.className = 'backend-status error';
                indicator.textContent = 'üî¥';
            }
            
            messageEl.textContent = message;
        }

        // Appel API backend avec gestion d'erreurs
        async function backendRequest(endpoint, options = {}) {
            const url = `${backendUrl}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            // Ajouter cl√© API si configur√©e
            if (backendApiKey && options.requireAuth) {
                headers['X-API-Key'] = backendApiKey;
            }
            
            const requestOptions = {
                ...options,
                headers
            };
            
            console.log(`üîó Appel backend: ${url}`);
            
            try {
                const response = await fetch(url, requestOptions);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `Erreur ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error(`‚ùå Erreur appel backend ${endpoint}:`, error);
                throw error;
            }
        }

        // ========================================
        // RECOMMANDATIONS INTELLIGENTES CORRIG√âES
        // ========================================
        async function generateIntelligentRecommendations() {
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = '<div class="loading">üß† Analyse IA en cours...</div>';
            
            try {
                // Utiliser l'endpoint qui fonctionne
                const data = await backendRequest('/api/v1/ai/demo/test_user');
                
                if (data && data.userPreferences) {
                    const prediction = data.prediction;
                    const preferences = data.userPreferences;
                    
                    const recommendations = `
                        <div style="margin-bottom: 15px; padding: 10px; background: linear-gradient(45deg, #e6fffa, #ffffff); border-radius: 8px; border-left: 4px solid #48bb78;">
                            <strong>üß† IA SurfAI a analys√© ${preferences.totalSessions} sessions</strong><br>
                            <span style="font-size: 0.9rem; color: #666;">Voici vos recommandations personnalis√©es :</span>
                        </div>
                        <div class="card">
                            <div style="position: absolute; top: 10px; right: 10px; background: #48bb78; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">
                                ${prediction.predictedScore}/10
                            </div>
                            <h4>üéØ ${prediction.spot} - Pr√©diction personnalis√©e</h4>
                            <p><strong>${prediction.recommendations ? prediction.recommendations.join(' ') : 'Session recommand√©e pour votre niveau'}</strong></p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; font-size: 0.9rem; color: #666;">
                                <div>üåä Vagues optimales: ${preferences.wavePreferences.optimalHeight.value}m</div>
                                <div>üí® Vent optimal: ${preferences.windPreferences.preferredDirection} ${preferences.windPreferences.optimalSpeed.value}km/h</div>
                                <div>üèñÔ∏è Spot favori: ${preferences.spotPreferences.favorite.name}</div>
                                <div>‚è∞ Heure: ${preferences.timePreferences.preferredHour}h</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 6px; font-size: 0.9rem; color: #666;">
                            üí° <strong>Insights IA :</strong> ${preferences.behavioralInsights.join(' ‚Ä¢ ')}
                        </div>
                    `;
                    
                    recommendationsDiv.innerHTML = recommendations;
                } else {
                    throw new Error('Pas de donn√©es de pr√©diction disponibles');
                }
                
            } catch (error) {
                console.error('‚ùå Erreur recommandations:', error);
                recommendationsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Erreur analyse IA: ${error.message}<br>
                        V√©rifiez que le backend est accessible.
                    </div>
                `;
            }
        }

        // ========================================
        // PR√âVISIONS M√âT√âO CORRIG√âES
        // ========================================
        async function getIntelligentForecast() {
            const spot = document.getElementById('forecast-spot').value;
            const level = document.getElementById('forecast-level').value;
            const days = document.getElementById('forecast-days').value;
            const forecastGrid = document.getElementById('forecast-grid');
            
            if (!spot) {
                showMessage('error', 'Veuillez s√©lectionner un spot');
                return;
            }
            
            forecastGrid.innerHTML = '<div class="loading">üåä R√©cup√©ration des pr√©visions...</div>';
            
            try {
                // Utiliser l'endpoint m√©t√©o auto qui fonctionne
                const weatherData = await backendRequest(`/api/v1/sessions/weather/auto?spot=${spot.charAt(0).toUpperCase() + spot.slice(1)}`);
                
                // Utiliser les pr√©dictions IA pour personnaliser
                const aiData = await backendRequest('/api/v1/ai/demo/test_user');
                
                // Cr√©er pr√©vision combin√©e
                const forecast = createCombinedForecast(weatherData, aiData, level, days);
                displaySimplifiedForecast(forecast, spot);
                
            } catch (error) {
                console.error('‚ùå Erreur pr√©visions:', error);
                forecastGrid.innerHTML = `
                    <div class="error">
                        ‚ùå Erreur: ${error.message}<br>
                        Impossible de r√©cup√©rer les pr√©visions m√©t√©o.
                    </div>
                `;
            }
        }

        // Fonction pour cr√©er pr√©vision combin√©e
        function createCombinedForecast(weatherData, aiData, level, days) {
            const currentConditions = weatherData.weather;
            const userPrefs = aiData.userPreferences;
            
            // Calculer score bas√© sur pr√©f√©rences IA
            let score = 5.0; // Score de base
            
            if (userPrefs && userPrefs.wavePreferences) {
                const waveOptimal = userPrefs.wavePreferences.optimalHeight.value;
                const waveDiff = Math.abs(currentConditions.waveHeight - waveOptimal);
                score -= waveDiff * 2; // P√©nalit√© selon √©cart
            }
            
            if (userPrefs && userPrefs.windPreferences) {
                const windOptimal = userPrefs.windPreferences.optimalSpeed.value;
                const windDiff = Math.abs(currentConditions.windSpeed - windOptimal);
                score -= windDiff * 0.1;
            }
            
            score = Math.max(1, Math.min(5, score)); // Limiter entre 1 et 5
            
            return {
                spot: weatherData.spot,
                conditions: currentConditions,
                score: score,
                userLevel: level,
                confidence: weatherData.weather.confidence * 100,
                recommendation: score >= 4 ? "Session excellente recommand√©e !" : 
                               score >= 3 ? "Bonnes conditions pour votre niveau" :
                               "Conditions moyennes, restez prudent"
            };
        }

        // Affichage pr√©vision simplifi√©e
        function displaySimplifiedForecast(forecast, spot) {
            const forecastGrid = document.getElementById('forecast-grid');
            
            let cardClass = 'forecast-card';
            let scoreClass = 'forecast-score';
            
            if (forecast.score >= 4) {
                cardClass += ' excellent';
                scoreClass += ' excellent';
            } else if (forecast.score >= 3) {
                cardClass += ' good';
                scoreClass += ' good';
            } else {
                cardClass += ' average';
                scoreClass += ' average';
            }
            
            forecastGrid.innerHTML = `
                <div class="card" style="margin-bottom: 15px; background: linear-gradient(45deg, #f0fff4, #ffffff); border-left: 4px solid #48bb78;">
                    <h4>üåä Pr√©visions ${forecast.spot}</h4>
                    <p><strong>Analyse bas√©e sur vos pr√©f√©rences IA personnalis√©es</strong></p>
                </div>
                
                <div class="${cardClass}">
                    <div class="forecast-header">
                        <span class="forecast-date">üìç ${spot.charAt(0).toUpperCase() + spot.slice(1)} - Maintenant</span>
                        <span class="${scoreClass}">${forecast.score.toFixed(1)}/5</span>
                    </div>
                    
                    <div class="forecast-conditions">
                        <div class="condition">üåä ${forecast.conditions.waveHeight.toFixed(1)}m</div>
                        <div class="condition">‚è±Ô∏è ${forecast.conditions.wavePeriod.toFixed(1)}s</div>
                        <div class="condition">üí® ${Math.round(forecast.conditions.windSpeed)}km/h</div>
                        <div class="condition">üß≠ ${forecast.conditions.windDirection}</div>
                        <div class="condition">üåä ${forecast.conditions.tide}</div>
                        <div class="condition">üå°Ô∏è ${forecast.conditions.waterTemp.toFixed(1)}¬∞C</div>
                    </div>
                    
                    <div class="prediction-info">
                        <div class="prediction-recommendation">
                            ${forecast.recommendation}
                        </div>
                        <div style="margin-top: 5px; font-size: 0.8rem; color: #666;">
                            Confiance: ${Math.round(forecast.confidence)}% ‚Ä¢ Analyse personnalis√©e
                        </div>
                    </div>
                </div>
                
                <div class="card" style="background: #f8fafc; margin-top: 15px;">
                    <h4>üí° Pourquoi ce score ?</h4>
                    <p style="font-size: 0.9rem;">L'IA analyse vos pr√©f√©rences personnelles pour calculer ce score. 
                    Plus vous enregistrez de sessions, plus les pr√©dictions sont pr√©cises !</p>
                </div>
            `;
        }

        // ========================================
        // PR√âDICTIONS ONGLET CORRIG√âES
        // ========================================
        async function generateIntelligentPredictions() {
            const level = document.getElementById('prediction-level').value;
            const days = document.getElementById('prediction-days').value;
            const predictionsDiv = document.getElementById('predictions-list');
            
            predictionsDiv.innerHTML = '<div class="loading">üß† Analyse pr√©dictions personnalis√©es...</div>';
            
            try {
                // R√©cup√©rer les donn√©es IA et m√©t√©o
                const aiData = await backendRequest('/api/v1/ai/demo/test_user');
                const weatherData = await backendRequest('/api/v1/sessions/weather/auto?spot=Biarritz');
                
                if (aiData && aiData.userPreferences) {
                    const userPrefs = aiData.userPreferences;
                    const currentConditions = weatherData.weather;
                    
                    // Simuler pr√©dictions pour les prochains jours
                    const predictions = generateMultiDayPredictions(userPrefs, currentConditions, parseInt(days));
                    
                    let predictionsHtml = `
                        <div class="card" style="margin-bottom: 20px; background: linear-gradient(45deg, #f0fff4, #ffffff); border-left: 4px solid #48bb78;">
                            <h4>üß† Analyse Intelligente Personnalis√©e</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                <div><strong>üìä Sessions analys√©es:</strong> ${userPrefs.totalSessions}</div>
                                <div><strong>üéØ Niveau:</strong> ${level}</div>
                                <div><strong>üìÖ Pr√©visions:</strong> ${days} jours</div>
                                <div><strong>‚≠ê Confiance:</strong> ${Math.round(userPrefs.reliabilityScore * 100)}%</div>
                            </div>
                            <div style="padding: 10px; background: #e6fffa; border-radius: 6px;">
                                <strong>üèÑ‚Äç‚ôÇÔ∏è Vos pr√©f√©rences apprises:</strong><br>
                                Vagues: ${userPrefs.wavePreferences.optimalHeight.value}m ‚Ä¢ 
                                Vent: ${userPrefs.windPreferences.preferredDirection} ${userPrefs.windPreferences.optimalSpeed.value}km/h ‚Ä¢ 
                                Spot favori: ${userPrefs.spotPreferences.favorite.name}
                            </div>
                        </div>
                    `;
                    
                    // Afficher pr√©dictions par jour
                    predictions.forEach((dayPred, index) => {
                        predictionsHtml += `
                            <div class="card" style="margin-bottom: 15px;">
                                <h4>üìÖ ${dayPred.date}</h4>
                                <div class="forecast-grid">
                                    ${createPredictionCard(dayPred, userPrefs)}
                                </div>
                            </div>
                        `;
                    });
                    
                    predictionsDiv.innerHTML = predictionsHtml;
                } else {
                    throw new Error('Donn√©es IA non disponibles');
                }
                
            } catch (error) {
                console.error('‚ùå Erreur pr√©dictions:', error);
                predictionsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Erreur pr√©dictions personnalis√©es: ${error.message}
                    </div>
                `;
            }
        }

        // G√©n√©rer pr√©dictions multi-jours simul√©es
        function generateMultiDayPredictions(userPrefs, baseConditions, days) {
            const predictions = [];
            
            for (let i = 0; i < days; i++) {
                const date = new Date();
                date.setDate(date.getDate() + i + 1);
                
                // Simuler variation des conditions
                const waveHeight = baseConditions.waveHeight + (Math.random() - 0.5) * 0.6;
                const windSpeed = baseConditions.windSpeed + (Math.random() - 0.5) * 10;
                
                // Calculer score personnalis√©
                let score = 5.0;
                const waveDiff = Math.abs(waveHeight - userPrefs.wavePreferences.optimalHeight.value);
                const windDiff = Math.abs(windSpeed - userPrefs.windPreferences.optimalSpeed.value);
                
                score -= waveDiff * 1.5;
                score -= windDiff * 0.08;
                score = Math.max(1, Math.min(5, score));
                
                predictions.push({
                    date: date.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }),
                    conditions: {
                        waveHeight: Math.max(0.3, waveHeight),
                        windSpeed: Math.max(5, windSpeed),
                        windDirection: baseConditions.windDirection
                    },
                    score: score,
                    recommendation: score >= 4 ? "üî• Session exceptionnelle pr√©vue !" : 
                                   score >= 3 ? "üëç Bonnes conditions pour vous" :
                                   "‚ö†Ô∏è Conditions moyennes"
                });
            }
            
            return predictions;
        }

        // Cr√©er carte de pr√©diction
        function createPredictionCard(prediction, userPrefs) {
            let cardClass = 'forecast-card';
            let scoreClass = 'forecast-score';
            
            if (prediction.score >= 4) {
                cardClass += ' excellent';
                scoreClass += ' excellent';
            } else if (prediction.score >= 3) {
                cardClass += ' good';
                scoreClass += ' good';
            } else {
                cardClass += ' average';
                scoreClass += ' average';
            }
            
            return `
                <div class="${cardClass}">
                    <div class="forecast-header">
                        <span class="forecast-date">${prediction.date}</span>
                        <span class="${scoreClass}">${prediction.score.toFixed(1)}/5</span>
                    </div>
                    
                    <div class="forecast-conditions">
                        <div class="condition">üåä ${prediction.conditions.waveHeight.toFixed(1)}m</div>
                        <div class="condition">üí® ${Math.round(prediction.conditions.windSpeed)}km/h</div>
                        <div class="condition">üß≠ ${prediction.conditions.windDirection}</div>
                    </div>
                    
                    <div class="prediction-info">
                        <div class="prediction-recommendation">
                            ${prediction.recommendation}
                        </div>
                        <div style="margin-top: 5px; font-size: 0.8rem; color: #666;">
                            Score bas√© sur vos ${userPrefs ? userPrefs.totalSessions : 'X'} sessions analys√©es
                        </div>
                    </div>
                </div>
            `;
        }

        // ========================================
        // TEST BACKEND CORRIG√â
        // ========================================
        async function testBackendConnection() {
            const url = document.getElementById('backend-url').value;
            const apiKey = document.getElementById('backend-api-key').value;
            const resultDiv = document.getElementById('backend-test-result');
            
            resultDiv.innerHTML = '<div class="loading">üß™ Test en cours...</div>';
            
            try {
                // Sauvegarder la config
                backendUrl = url;
                backendApiKey = apiKey;
                localStorage.setItem('backend_url', url);
                localStorage.setItem('backend_api_key', apiKey);
                
                // Test health check
                const healthResponse = await fetch(`${url}/health`);
                const healthData = await healthResponse.json();
                
                if (!healthResponse.ok) {
                    throw new Error(`Backend non accessible (${healthResponse.status})`);
                }
                
                // Test API IA
                const aiResponse = await fetch(`${url}/api/v1/ai/test`);
                const aiData = await aiResponse.json();
                
                // Test m√©t√©o auto
                const weatherResponse = await fetch(`${url}/api/v1/sessions/weather/auto?spot=Biarritz`);
                const weatherData = await weatherResponse.json();
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Backend SurfAI connect√© !<br>
                        ü•º Health: ${healthData.status}<br>
                        ü§ñ IA Engine: ${aiData.status === 'UPGRADED_TO_V2' ? '‚úÖ v2.0 Fonctionnel' : '‚ö†Ô∏è Basique'}<br>
                        üåä M√©t√©o Auto: ${weatherData.success ? '‚úÖ Fonctionnel' : '‚ùå Erreur'}<br>
                        üìä Confiance m√©t√©o: ${weatherData.weather ? Math.round(weatherData.weather.confidence * 100) + '%' : 'N/A'}
                    </div>
                `;
                
                updateBackendStatus(true, 'Backend SurfAI v2.0 connect√© et fonctionnel');
                updateAppStatus();
                
            } catch (error) {
                console.error('Erreur test backend:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ${error.message}<br>
                        V√©rifiez que le backend est d√©marr√© sur le bon port.
                    </div>
                `;
                updateBackendStatus(false, `Erreur: ${error.message}`);
            }
        }

        // ========================================
        // FONCTIONS SESSIONS ET PROFIL
        // ========================================
        async function submitSession() {
            const spot = document.getElementById('session-spot').value;
            const date = document.getElementById('session-date').value;
            const rating = document.getElementById('session-rating').value;
            const notes = document.getElementById('session-notes').value;
            
            if (!spot || !date || !rating) {
                showMessage('error', 'Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            try {
                const sessionData = {
                    userId: 'demo_user',
                    spot: spot,
                    date: `${date}T08:00:00Z`,
                    rating: parseInt(rating),
                    notes: notes,
                    duration: 90
                };
                
                const response = await backendRequest('/api/v1/sessions/quick', {
                    method: 'POST',
                    body: JSON.stringify(sessionData)
                });
                
                showMessage('success', 'Session enregistr√©e avec succ√®s !');
                
                // Reset form
                document.getElementById('session-spot').value = '';
                document.getElementById('session-rating').value = '';
                document.getElementById('session-notes').value = '';
                
            } catch (error) {
                showMessage('error', `Erreur: ${error.message}`);
            }
        }

        function saveProfile() {
            const nickname = document.getElementById('profile-nickname').value;
            const level = document.getElementById('profile-level').value;
            const waveMin = document.getElementById('profile-wave-min').value;
            const waveMax = document.getElementById('profile-wave-max').value;
            
            userData.profile = {
                nickname,
                level,
                wavePreferences: {
                    min: parseFloat(waveMin) || 0.8,
                    max: parseFloat(waveMax) || 2.5
                }
            };
            
            localStorage.setItem('surfai_profile', JSON.stringify(userData.profile));
            showMessage('success', 'Profil sauvegard√© !');
        }

        function addBoard() {
            const name = document.getElementById('board-name').value;
            const size = document.getElementById('board-size').value;
            const type = document.getElementById('board-type').value;
            const shaper = document.getElementById('board-shaper').value;
            
            if (!name || !size || !type || !shaper) {
                showMessage('error', 'Veuillez remplir tous les champs');
                return;
            }
            
            const board = { name, size, type, shaper, id: Date.now() };
            userData.boards.push(board);
            
            // Reset form
            document.getElementById('board-name').value = '';
            document.getElementById('board-size').value = '';
            document.getElementById('board-type').value = '';
            document.getElementById('board-shaper').value = '';
            
            showMessage('success', 'Board ajout√©e !');
            loadProfile();
        }

        // ========================================
        // FONCTIONS NAVIGATION ET UTILITAIRES
        // ========================================

        // Navigation entre onglets
        function showTab(tabName) {
            // Masquer tous les onglets
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Afficher l'onglet s√©lectionn√©
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Charger les donn√©es si n√©cessaire
            if (tabName === 'sessions') loadSessions();
            if (tabName === 'spots') loadSpots();
            if (tabName === 'profile') loadProfile();
            if (tabName === 'predictions') generateIntelligentPredictions();
        }

        // Fonctions de donn√©es simplifi√©es
        function loadSessions() {
            const sessionsList = document.getElementById('sessions-list');
            sessionsList.innerHTML = `
                <div class="card">
                    <p>üèÑ‚Äç‚ôÇÔ∏è Vos sessions appara√Ætront ici une fois enregistr√©es.</p>
                    <p>Le backend SurfAI est pr√™t √† traiter vos donn√©es !</p>
                </div>
            `;
        }

        function loadSpots() {
            const favoritesList = document.getElementById('favorite-spots-list');
            const allSpotsList = document.getElementById('all-spots-list');
            
            favoritesList.innerHTML = `
                <div class="card">
                    <h4>‚≠ê Biarritz</h4>
                    <p>üìç Pays Basque - Spot principal</p>
                    <p style="font-size: 0.9rem; color: #666;">üññ Beach break ‚Ä¢ üí® Vent: N, NE</p>
                </div>
            `;
            
            allSpotsList.innerHTML = `
                <div class="card">
                    <h4>üèÑ‚Äç‚ôÇÔ∏è Biarritz Grande Plage</h4>
                    <p>üìç Pays Basque</p>
                    <p style="font-size: 0.9rem; color: #666;">üññ Beach break ‚Ä¢ üí® Vent optimal: N, NE</p>
                </div>
                <div class="card">
                    <h4>üìç Hossegor</h4>
                    <p>üìç Nouvelle-Aquitaine</p>
                    <p style="font-size: 0.9rem; color: #666;">üññ Beach break ‚Ä¢ üí® Vent optimal: E, SE</p>
                </div>
            `;
        }

        function loadProfile() {
            const boardsList = document.getElementById('user-boards-list');
            
            if (userData.boards && userData.boards.length > 0) {
                const boardsHtml = userData.boards.map(board => `
                    <div class="card">
                        <h4>${board.name}</h4>
                        <p>üìè Taille: ${board.size} ‚Ä¢ üèÑ‚Äç‚ôÇÔ∏è Type: ${board.type}</p>
                        <p>üî® Shaper: ${board.shaper}</p>
                    </div>
                `).join('');
                
                boardsList.innerHTML = boardsHtml;
            } else {
                boardsList.innerHTML = `
                    <div class="card">
                        <p>üèÑ‚Äç‚ôÇÔ∏è Ajoutez vos boards ci-dessus pour commencer !</p>
                    </div>
                `;
            }
        }

        function analyzePatterns() {
            const patternsDiv = document.getElementById('patterns');
            patternsDiv.innerHTML = '<div class="loading">üß† Analyse de vos patterns...</div>';
            
            setTimeout(() => {
                patternsDiv.innerHTML = `
                    <div class="success">
                        <h4>üéØ Vos patterns d√©tect√©s :</h4>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üåä Conditions optimales: vagues 1.2-1.8m</li>
                            <li>üí® Vent pr√©f√©r√©: 10-15 km/h offshore</li>
                            <li>üìç Spot favori: Biarritz</li>
                            <li>‚è∞ Horaire pr√©f√©r√©: 8h-10h et 17h-19h</li>
                        </ul>
                        <p style="margin-top: 15px;">
                            <strong>üí° L'IA recommande:</strong> 
                            Surveillez les sessions avec vent NE l√©ger et houle de 1.5m pour vos meilleures performances !
                        </p>
                    </div>
                `;
            }, 2000);
        }

        // Fonctions utilitaires
        function showMessage(type, message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = message;
            
            const activeTab = document.querySelector('.tab-panel.active');
            activeTab.insertBefore(messageDiv, activeTab.firstChild);
            
            setTimeout(() => messageDiv.remove(), 3000);
        }

        function updateAppStatus() {
            const statusDiv = document.getElementById('app-status');
            statusDiv.innerHTML = `
                <p>üü¢ Backend: Connect√© et fonctionnel</p>
                <p>üü¢ IA Engine: v2.0 Op√©rationnel</p>
                <p>üü¢ Donn√©es: Pr√™tes pour l'IA</p>
            `;
        }

        // Mettre √† jour les statistiques du dashboard
        function updateDashboard() {
            document.getElementById('total-sessions').textContent = userData.sessions.length;
            document.getElementById('avg-rating').textContent = userData.sessions.length > 0 ? 
                (userData.sessions.reduce((sum, s) => sum + s.rating, 0) / userData.sessions.length).toFixed(1) : '-';
            document.getElementById('favorite-spots').textContent = userData.favoriteSpots.length;
        }
    </script>
</body>
</html>
