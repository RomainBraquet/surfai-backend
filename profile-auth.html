<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurfAI - Connexion & Profil</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .auth-container, .profile-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .auth-tab.active {
            background: #667eea;
            color: white;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .button.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .button.secondary:hover {
            background: #cbd5e0;
        }
        
        .button.danger {
            background: #f56565;
        }
        
        .button.danger:hover {
            background: #e53e3e;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .profile-avatar {
            position: relative;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.05);
        }
        
        .avatar-placeholder {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .avatar-placeholder:hover {
            transform: scale(1.05);
        }
        
        .profile-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .profile-info h2 {
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .profile-email {
            color: #666;
            font-size: 0.9rem;
        }
        
        .profile-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .status-verified {
            background: #c6f6d5;
            color: #25543e;
        }
        
        .status-unverified {
            background: #fed7d7;
            color: #c53030;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .success {
            background: #c6f6d5;
            color: #25543e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .hidden {
            display: none !important;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SurfAI</h1>
            <p>Votre profil personnalis√© pour des pr√©dictions optimales</p>
        </div>
        
        <!-- Section Authentification -->
        <div id="auth-section" class="auth-container">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">
                    Connexion
                </div>
                <div class="auth-tab" onclick="switchAuthTab('register')">
                    Inscription
                </div>
            </div>
            
            <!-- Formulaire de connexion -->
            <div id="login-form" class="auth-form active">
                <h2 style="margin-bottom: 20px; color: #667eea;">Se connecter</h2>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button onclick="handleLogin()" class="button">
                    Se connecter
                </button>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="showForgotPassword()" style="color: #667eea; font-size: 0.9rem;">Mot de passe oubli√© ?</a>
                </div>
            </div>
            
            <!-- Formulaire d'inscription -->
            <div id="register-form" class="auth-form">
                <h2 style="margin-bottom: 20px; color: #667eea;">Cr√©er un compte</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pr√©nom</label>
                        <input type="text" id="register-firstname" placeholder="Votre pr√©nom" required>
                    </div>
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" id="register-lastname" placeholder="Votre nom" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" placeholder="votre@email.com" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Mot de passe</label>
                        <input type="password" id="register-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="form-group">
                        <label>Confirmer mot de passe</label>
                        <input type="password" id="register-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Niveau de surf</label>
                    <select id="register-level" required>
                        <option value="">S√©lectionnez votre niveau</option>
                        <option value="beginner">D√©butant</option>
                        <option value="intermediate">Interm√©diaire</option>
                        <option value="advanced">Avanc√©</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
                <button onclick="handleRegister()" class="button">
                    Cr√©er mon compte
                </button>
            </div>
            
            <!-- Messages -->
            <div id="auth-messages"></div>
        </div>
        
        <!-- Section Profil (cach√©e par d√©faut) -->
        <div id="profile-section" class="profile-container hidden">
            <button onclick="handleLogout()" class="button secondary logout-btn">
                D√©connexion
            </button>
            
            <div class="profile-header">
                <div class="profile-avatar">
                    <div id="avatar-display" class="avatar-placeholder" onclick="triggerPhotoUpload()">
                        SU
                    </div>
                    <button class="profile-upload" onclick="triggerPhotoUpload()">
                        üì∑
                    </button>
                    <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                </div>
                <div class="profile-info">
                    <h2 id="profile-display-name">Utilisateur SurfAI</h2>
                    <div class="profile-email" id="profile-display-email">email@example.com</div>
                    <div id="profile-verification-status" class="profile-status status-unverified">
                        Email non v√©rifi√©
                    </div>
                </div>
            </div>
            
            <!-- Informations personnelles -->
            <div class="card">
                <h3>Informations personnelles</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pr√©nom</label>
                        <input type="text" id="profile-firstname" placeholder="Votre pr√©nom">
                    </div>
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" id="profile-lastname" placeholder="Votre nom">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pseudo</label>
                        <input type="text" id="profile-nickname" placeholder="Votre pseudo de surfeur">
                    </div>
                    <div class="form-group">
                        <label>Localisation</label>
                        <input type="text" id="profile-location" placeholder="Biarritz, France" value="Biarritz, France">
                    </div>
                </div>
                <div class="form-group">
                    <label>Bio</label>
                    <textarea id="profile-bio" rows="3" placeholder="Parlez-nous de votre passion pour le surf..."></textarea>
                </div>
            </div>
            
            <!-- Pr√©f√©rences de surf -->
            <div class="card">
                <h3>Pr√©f√©rences de surf</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Niveau de surf</label>
                        <select id="profile-surf-level">
                            <option value="beginner">D√©butant</option>
                            <option value="intermediate" selected>Interm√©diaire</option>
                            <option value="advanced">Avanc√©</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ann√©es d'exp√©rience</label>
                        <input type="number" id="profile-years-experience" min="0" max="50" placeholder="5">
                    </div>
                </div>
                <h4 style="margin: 20px 0 10px 0; color: #667eea;">Taille de vagues pr√©f√©r√©es</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Taille minimum (m√®tres)</label>
                        <input type="number" id="profile-wave-min" step="0.1" min="0.3" max="5" placeholder="0.7" value="0.7">
                    </div>
                    <div class="form-group">
                        <label>Taille maximum (m√®tres)</label>
                        <input type="number" id="profile-wave-max" step="0.1" min="0.5" max="8" placeholder="1.8" value="1.8">
                    </div>
                </div>
            </div>
            
            <!-- Param√®tres de s√©curit√© -->
            <div class="card">
                <h3>S√©curit√© du compte</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nouveau mot de passe</label>
                        <input type="password" id="profile-new-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="form-group">
                        <label>Confirmer nouveau mot de passe</label>
                        <input type="password" id="profile-new-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                </div>
                <button onclick="updatePassword()" class="button secondary" style="margin-bottom: 10px;">
                    Changer le mot de passe
                </button>
                <div id="email-verification" style="margin-top: 15px;">
                    <button onclick="sendVerificationEmail()" class="button secondary">
                        Renvoyer email de v√©rification
                    </button>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button onclick="saveProfile()" class="button">
                    Sauvegarder le profil
                </button>
                <button onclick="deleteAccount()" class="button danger" style="margin-left: 10px;">
                    Supprimer le compte
                </button>
            </div>
            
            <!-- Messages profil -->
            <div id="profile-messages"></div>
        </div>
    </div>

    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://zssiqpxlqshsmhpqjzgb.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpzc2lxcHhscXNoc21ocHFqemdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwNTY5MzgsImV4cCI6MjA2MDYzMjkzOH0.H7tpOyc-iFCQLf4eHOMfJ0T09NvpHy_6kw2onaiJJcw'; // √Ä remplacer par votre vraie cl√©
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        let currentUser = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
        });

        // V√©rifier l'√©tat d'authentification au chargement
        async function checkAuthState() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    currentUser = user;
                    showProfileSection();
                    await loadUserProfile();
                } else {
                    showAuthSection();
                }
            } catch (error) {
                console.error('Erreur v√©rification auth:', error);
                showAuthSection();
            }
        }

        // Gestion des onglets d'authentification
        function switchAuthTab(tab) {
            // Mettre √† jour les onglets
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.auth-tab:nth-child(${tab === 'login' ? '1' : '2'})`).classList.add('active');
            
            // Mettre √† jour les formulaires
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById(tab === 'login' ? 'login-form' : 'register-form').classList.add('active');
            
            clearMessages('auth');
        }

        // Connexion
        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showMessage('auth', 'error', 'Veuillez remplir tous les champs');
                return;
            }
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                showMessage('auth', 'success', 'Connexion r√©ussie !');
                
                setTimeout(() => {
                    showProfileSection();
                    loadUserProfile();
                }, 1000);
                
            } catch (error) {
                console.error('Erreur connexion:', error);
                showMessage('auth', 'error', `Erreur: ${error.message}`);
            }
        }

        // Inscription
        async function handleRegister() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const passwordConfirm = document.getElementById('register-password-confirm').value;
            const firstname = document.getElementById('register-firstname').value;
            const lastname = document.getElementById('register-lastname').value;
            const level = document.getElementById('register-level').value;
            
            // Validation
            if (!email || !password || !firstname || !lastname || !level) {
                showMessage('auth', 'error', 'Veuillez remplir tous les champs');
                return;
            }
            
            if (password !== passwordConfirm) {
                showMessage('auth', 'error', 'Les mots de passe ne correspondent pas');
                return;
            }
            
            if (password.length < 6) {
                showMessage('auth', 'error', 'Le mot de passe doit contenir au moins 6 caract√®res');
                return;
            }
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            first_name: firstname,
                            last_name: lastname,
                            surf_level: level,
                            full_name: `${firstname} ${lastname}`
                        }
                    }
                });
                
                if (error) throw error;
                
                showMessage('auth', 'success', 'Inscription r√©ussie ! V√©rifiez votre email pour confirmer votre compte.');
                
                // Cr√©er le profil dans notre table
                if (data.user) {
                    await createUserProfile(data.user, { firstname, lastname, level });
                }
                
            } catch (error) {
                console.error('Erreur inscription:', error);
                showMessage('auth', 'error', `Erreur: ${error.message}`);
            }
        }

        // Cr√©er profil utilisateur
        async function createUserProfile(user, additionalData) {
            try {
                const { error } = await supabase
                    .from('profile')
                    .insert([{
                        uuid: user.id,
                        email: user.email,
                        nickname: additionalData.firstname,
                        surf_level: additionalData.level,
                        min_wave_height: 0.7,
                        max_wave_height: 1.8,
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                console.log('Profil cr√©√© avec succ√®s');
                
            } catch (error) {
                console.error('Erreur cr√©ation profil:', error);
            }
        }

        // Charger profil utilisateur
        async function loadUserProfile() {
            if (!currentUser) return;
            
            try {
                const { data: profile, error } = await supabase
                    .from('profile')
                    .select('*')
                    .eq('uuid', currentUser.id)
                    .single();
                
                if (error && error.code !== 'PGRST116') throw error;
                
                // Remplir les champs avec les donn√©es utilisateur
                document.getElementById('profile-display-name').textContent = 
                    currentUser.user_metadata?.full_name || profile?.nickname || 'Utilisateur SurfAI';
                document.getElementById('profile-display-email').textContent = currentUser.email;
                
                // Statut de v√©rification
                const verificationElement = document.getElementById('profile-verification-status');
                if (currentUser.email_confirmed_at) {
                    verificationElement.textContent = 'Email v√©rifi√©';
                    verificationElement.className = 'profile-status status-verified';
                } else {
                    verificationElement.textContent = 'Email non v√©rifi√©';
                    verificationElement.className = 'profile-status status-unverified';
                }
                
                // Remplir les champs du formulaire
                if (profile) {
                    document.getElementById('profile-nickname').value = profile.nickname || '';
                    document.getElementById('profile-surf-level').value = profile.surf_level || 'intermediate';
                    document.getElementById('profile-wave-min').value = profile.min_wave_height || 0.7;
                    document.getElementById('profile-wave-max').value = profile.max_wave_height || 1.8;
                }
                
                // Mettre √† jour l'avatar
                updateAvatarDisplay();
                
            } catch (error) {
                console.error('Erreur chargement profil:', error);
            }
        }

        // Sauvegarder profil
        async function saveProfile() {
            if (!currentUser) return;
            
            try {
                const profileData = {
                    nickname: document.getElementById('profile-nickname').value,
                    surf_level: document.getElementById('profile-surf-level').value,
                    min_wave_height: parseFloat(document.getElementById('profile-wave-min').value),
                    max_wave_height: parseFloat(document.getElementById('profile-wave-max').value),
                    updated_at: new Date().toISOString()
                };
                
                const { error } = await supabase
                    .from('profile')
                    .upsert([{
                        uuid: currentUser.id,
                        ...profileData
                    }]);
                
                if (error) throw error;
                
                showMessage('profile', 'success', 'Profil sauvegard√© avec succ√®s !');
                await loadUserProfile();
                
            } catch (error) {
                console.error('Erreur sauvegarde profil:', error);
                showMessage('profile', 'error', `Erreur: ${error.message}`);
            }
        }

        // Mettre √† jour mot de passe
        async function updatePassword() {
            const newPassword = document.getElementById('profile-new-password').value;
            const confirmPassword = document.getElementById('profile-new-password-confirm').value;
            
            if (!newPassword || !confirmPassword) {
                showMessage('profile', 'error', 'Veuillez remplir les deux champs de mot de passe');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('profile', 'error', 'Les mots de passe ne correspondent pas');
                return;
            }
            
            if (newPassword.length < 6) {
                showMessage('profile', 'error', 'Le mot de passe doit contenir au moins 6 caract√®res');
                return;
            }
            
            try {
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });
                
                if (error) throw error;
                
                document.getElementById('profile-new-password').value = '';
                document.getElementById('profile-new-password-confirm').value = '';
                
                showMessage('profile', 'success', 'Mot de passe mis √† jour avec succ√®s !');
                
            } catch (error) {
                console.error('Erreur mise √† jour mot de passe:', error);
                showMessage('profile', 'error', `Erreur: ${error.message}`);
            }
        }

        // Envoyer email de v√©rification
        async function sendVerificationEmail() {
            try {
                const { error } = await supabase.auth.resend({
                    type: 'signup',
                    email: currentUser.email
                });
                
                if (error) throw error;
                
                showMessage('profile', 'success', 'Email de v√©rification envoy√© !');
                
            } catch (error) {
                console.error('Erreur envoi email:', error);
                showMessage('profile', 'error', `Erreur: ${error.message}`);
            }
        }

        // Upload photo de profil
        function triggerPhotoUpload() {
            document.getElementById('avatar-input').click();
        }

        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // V√©rifications
            if (!file.type.startsWith('image/')) {
                showMessage('profile', 'error', 'Veuillez s√©lectionner une image');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) { // 2MB
                showMessage('profile', 'error', 'L\'image doit faire moins de 2MB');
                return;
            }
            
            try {
                const fileExt = file.name.split('.').pop();
                const fileName = `avatar-${currentUser.id}.${fileExt}`;
                
                const { error: uploadError } = await supabase.storage
                    .from('avatars')
                    .upload(fileName, file, {
                        upsert: true
                    });
                
                if (uploadError) throw uploadError;
                
                // Obtenir l'URL publique
                const { data } = supabase.storage
                    .from('avatars')
                    .getPublicUrl(fileName);
                
                // Mettre √† jour le profil avec l'URL de l'avatar
                const { error: updateError } = await supabase.auth.updateUser({
                    data: { avatar_url: data.publicUrl }
                });
                
                if (updateError) throw updateError;
                
                showMessage('profile', 'success', 'Photo de profil mise √† jour !');
                updateAvatarDisplay();
                
            } catch (error) {
                console.error('Erreur upload photo:', error);
                showMessage('profile', 'error', `Erreur: ${error.message}`);
            }
        }

        // Mettre √† jour affichage avatar
        function updateAvatarDisplay() {
            const avatarDisplay = document.getElementById('avatar-display');
            const avatarUrl = currentUser?.user_metadata?.avatar_url;
            
            if (avatarUrl) {
                avatarDisplay.innerHTML = `<img src="${avatarUrl}" alt="Avatar" class="avatar">`;
            } else {
                const initials = getInitials();
                avatarDisplay.className = 'avatar-placeholder';
                avatarDisplay.textContent = initials;
            }
        }

        // Obtenir initiales
        function getInitials() {
            const name = currentUser?.user_metadata?.full_name || 
                        document.getElementById('profile-nickname')?.value ||
                        'SU';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        // D√©connexion
        async function handleLogout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                
                currentUser = null;
                showAuthSection();
                
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
            }
        }

        // Supprimer compte
        async function deleteAccount() {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer votre compte ? Cette action est irr√©versible.')) {
                return;
            }
            
            if (!confirm('Confirmez-vous la suppression d√©finitive de votre compte ?')) {
                return;
            }
            
            try {
                // Supprimer le profil de la base de donn√©es
                const { error: profileError } = await supabase
                    .from('profile')
                    .delete()
                    .eq('uuid', currentUser.id);
                
                if (profileError) throw profileError;
                
                // Note: La suppression du compte auth doit √™tre faite c√¥t√© serveur
                // Pour l'instant, on d√©connecte juste l'utilisateur
                await handleLogout();
                
                showMessage('auth', 'success', 'Compte supprim√© avec succ√®s');
                
            } catch (error) {
                console.error('Erreur suppression compte:', error);
                showMessage('profile', 'error', `Erreur: ${error.message}`);
            }
        }

        // Fonctions d'affichage
        function showAuthSection() {
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('profile-section').classList.add('hidden');
        }

        function showProfileSection() {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('profile-section').classList.remove('hidden');
        }

        // Fonctions utilitaires
        function showMessage(section, type, message) {
            const messagesContainer = document.getElementById(`${section}-messages`);
            messagesContainer.innerHTML = `<div class="${type}">${message}</div>`;
            
            setTimeout(() => {
                messagesContainer.innerHTML = '';
            }, 5000);
        }

        function clearMessages(section) {
            document.getElementById(`${section}-messages`).innerHTML = '';
        }

        // Mot de passe oubli√©
        async function showForgotPassword() {
            const email = prompt('Entrez votre adresse email pour r√©initialiser votre mot de passe:');
            if (!email) return;
            
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email);
                if (error) throw error;
                
                showMessage('auth', 'success', 'Email de r√©initialisation envoy√© !');
                
            } catch (error) {
                console.error('Erreur reset password:', error);
                showMessage('auth', 'error', `Erreur: ${error.message}`);
            }
        }
    </script>
</body>
</html>
